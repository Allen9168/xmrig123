name: Build XMRig

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-linux:
    runs-on: ubuntu-latest

    steps:
      # 1. 拉取代码
      - name: Checkout
        uses: actions/checkout@v4

      # 2. 安装编译依赖（XMRig 需要这些库）
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            git build-essential cmake automake libtool autoconf \
            libuv1-dev libssl-dev libhwloc-dev

      # 3. CMake 配置
      - name: Configure
        run: |
          mkdir build
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release

      # 4. 编译
      - name: Build
        run: |
          cd build
          cmake --build . --config Release -- -j"$(nproc)"

      # 5. 上传编译好的二进制文件，方便从 Actions 页面下载
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: xmrig-linux
          path: build/xmrig
